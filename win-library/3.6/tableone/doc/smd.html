<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

<title>Standardized mean difference</title>

<script type="text/javascript">
window.onload = function() {
  var imgs = document.getElementsByTagName('img'), i, img;
  for (i = 0; i < imgs.length; i++) {
    img = imgs[i];
    // center an image if it is the only element of its parent
    if (img.parentElement.childElementCount === 1)
      img.parentElement.style.textAlign = 'center';
  }
};
</script>

<!-- Styles for R syntax highlighter -->
<style type="text/css">
   pre .operator,
   pre .paren {
     color: rgb(104, 118, 135)
   }

   pre .literal {
     color: #990073
   }

   pre .number {
     color: #099;
   }

   pre .comment {
     color: #998;
     font-style: italic
   }

   pre .keyword {
     color: #900;
     font-weight: bold
   }

   pre .identifier {
     color: rgb(0, 0, 0);
   }

   pre .string {
     color: #d14;
   }
</style>

<!-- R syntax highlighter -->
<script type="text/javascript">
var hljs=new function(){function m(p){return p.replace(/&/gm,"&amp;").replace(/</gm,"&lt;")}function f(r,q,p){return RegExp(q,"m"+(r.cI?"i":"")+(p?"g":""))}function b(r){for(var p=0;p<r.childNodes.length;p++){var q=r.childNodes[p];if(q.nodeName=="CODE"){return q}if(!(q.nodeType==3&&q.nodeValue.match(/\s+/))){break}}}function h(t,s){var p="";for(var r=0;r<t.childNodes.length;r++){if(t.childNodes[r].nodeType==3){var q=t.childNodes[r].nodeValue;if(s){q=q.replace(/\n/g,"")}p+=q}else{if(t.childNodes[r].nodeName=="BR"){p+="\n"}else{p+=h(t.childNodes[r])}}}if(/MSIE [678]/.test(navigator.userAgent)){p=p.replace(/\r/g,"\n")}return p}function a(s){var r=s.className.split(/\s+/);r=r.concat(s.parentNode.className.split(/\s+/));for(var q=0;q<r.length;q++){var p=r[q].replace(/^language-/,"");if(e[p]){return p}}}function c(q){var p=[];(function(s,t){for(var r=0;r<s.childNodes.length;r++){if(s.childNodes[r].nodeType==3){t+=s.childNodes[r].nodeValue.length}else{if(s.childNodes[r].nodeName=="BR"){t+=1}else{if(s.childNodes[r].nodeType==1){p.push({event:"start",offset:t,node:s.childNodes[r]});t=arguments.callee(s.childNodes[r],t);p.push({event:"stop",offset:t,node:s.childNodes[r]})}}}}return t})(q,0);return p}function k(y,w,x){var q=0;var z="";var s=[];function u(){if(y.length&&w.length){if(y[0].offset!=w[0].offset){return(y[0].offset<w[0].offset)?y:w}else{return w[0].event=="start"?y:w}}else{return y.length?y:w}}function t(D){var A="<"+D.nodeName.toLowerCase();for(var B=0;B<D.attributes.length;B++){var C=D.attributes[B];A+=" "+C.nodeName.toLowerCase();if(C.value!==undefined&&C.value!==false&&C.value!==null){A+='="'+m(C.value)+'"'}}return A+">"}while(y.length||w.length){var v=u().splice(0,1)[0];z+=m(x.substr(q,v.offset-q));q=v.offset;if(v.event=="start"){z+=t(v.node);s.push(v.node)}else{if(v.event=="stop"){var p,r=s.length;do{r--;p=s[r];z+=("</"+p.nodeName.toLowerCase()+">")}while(p!=v.node);s.splice(r,1);while(r<s.length){z+=t(s[r]);r++}}}}return z+m(x.substr(q))}function j(){function q(x,y,v){if(x.compiled){return}var u;var s=[];if(x.k){x.lR=f(y,x.l||hljs.IR,true);for(var w in x.k){if(!x.k.hasOwnProperty(w)){continue}if(x.k[w] instanceof Object){u=x.k[w]}else{u=x.k;w="keyword"}for(var r in u){if(!u.hasOwnProperty(r)){continue}x.k[r]=[w,u[r]];s.push(r)}}}if(!v){if(x.bWK){x.b="\\b("+s.join("|")+")\\s"}x.bR=f(y,x.b?x.b:"\\B|\\b");if(!x.e&&!x.eW){x.e="\\B|\\b"}if(x.e){x.eR=f(y,x.e)}}if(x.i){x.iR=f(y,x.i)}if(x.r===undefined){x.r=1}if(!x.c){x.c=[]}x.compiled=true;for(var t=0;t<x.c.length;t++){if(x.c[t]=="self"){x.c[t]=x}q(x.c[t],y,false)}if(x.starts){q(x.starts,y,false)}}for(var p in e){if(!e.hasOwnProperty(p)){continue}q(e[p].dM,e[p],true)}}function d(B,C){if(!j.called){j();j.called=true}function q(r,M){for(var L=0;L<M.c.length;L++){if((M.c[L].bR.exec(r)||[null])[0]==r){return M.c[L]}}}function v(L,r){if(D[L].e&&D[L].eR.test(r)){return 1}if(D[L].eW){var M=v(L-1,r);return M?M+1:0}return 0}function w(r,L){return L.i&&L.iR.test(r)}function K(N,O){var M=[];for(var L=0;L<N.c.length;L++){M.push(N.c[L].b)}var r=D.length-1;do{if(D[r].e){M.push(D[r].e)}r--}while(D[r+1].eW);if(N.i){M.push(N.i)}return f(O,M.join("|"),true)}function p(M,L){var N=D[D.length-1];if(!N.t){N.t=K(N,E)}N.t.lastIndex=L;var r=N.t.exec(M);return r?[M.substr(L,r.index-L),r[0],false]:[M.substr(L),"",true]}function z(N,r){var L=E.cI?r[0].toLowerCase():r[0];var M=N.k[L];if(M&&M instanceof Array){return M}return false}function F(L,P){L=m(L);if(!P.k){return L}var r="";var O=0;P.lR.lastIndex=0;var M=P.lR.exec(L);while(M){r+=L.substr(O,M.index-O);var N=z(P,M);if(N){x+=N[1];r+='<span class="'+N[0]+'">'+M[0]+"</span>"}else{r+=M[0]}O=P.lR.lastIndex;M=P.lR.exec(L)}return r+L.substr(O,L.length-O)}function J(L,M){if(M.sL&&e[M.sL]){var r=d(M.sL,L);x+=r.keyword_count;return r.value}else{return F(L,M)}}function I(M,r){var L=M.cN?'<span class="'+M.cN+'">':"";if(M.rB){y+=L;M.buffer=""}else{if(M.eB){y+=m(r)+L;M.buffer=""}else{y+=L;M.buffer=r}}D.push(M);A+=M.r}function G(N,M,Q){var R=D[D.length-1];if(Q){y+=J(R.buffer+N,R);return false}var P=q(M,R);if(P){y+=J(R.buffer+N,R);I(P,M);return P.rB}var L=v(D.length-1,M);if(L){var O=R.cN?"</span>":"";if(R.rE){y+=J(R.buffer+N,R)+O}else{if(R.eE){y+=J(R.buffer+N,R)+O+m(M)}else{y+=J(R.buffer+N+M,R)+O}}while(L>1){O=D[D.length-2].cN?"</span>":"";y+=O;L--;D.length--}var r=D[D.length-1];D.length--;D[D.length-1].buffer="";if(r.starts){I(r.starts,"")}return R.rE}if(w(M,R)){throw"Illegal"}}var E=e[B];var D=[E.dM];var A=0;var x=0;var y="";try{var s,u=0;E.dM.buffer="";do{s=p(C,u);var t=G(s[0],s[1],s[2]);u+=s[0].length;if(!t){u+=s[1].length}}while(!s[2]);if(D.length>1){throw"Illegal"}return{r:A,keyword_count:x,value:y}}catch(H){if(H=="Illegal"){return{r:0,keyword_count:0,value:m(C)}}else{throw H}}}function g(t){var p={keyword_count:0,r:0,value:m(t)};var r=p;for(var q in e){if(!e.hasOwnProperty(q)){continue}var s=d(q,t);s.language=q;if(s.keyword_count+s.r>r.keyword_count+r.r){r=s}if(s.keyword_count+s.r>p.keyword_count+p.r){r=p;p=s}}if(r.language){p.second_best=r}return p}function i(r,q,p){if(q){r=r.replace(/^((<[^>]+>|\t)+)/gm,function(t,w,v,u){return w.replace(/\t/g,q)})}if(p){r=r.replace(/\n/g,"<br>")}return r}function n(t,w,r){var x=h(t,r);var v=a(t);var y,s;if(v){y=d(v,x)}else{return}var q=c(t);if(q.length){s=document.createElement("pre");s.innerHTML=y.value;y.value=k(q,c(s),x)}y.value=i(y.value,w,r);var u=t.className;if(!u.match("(\\s|^)(language-)?"+v+"(\\s|$)")){u=u?(u+" "+v):v}if(/MSIE [678]/.test(navigator.userAgent)&&t.tagName=="CODE"&&t.parentNode.tagName=="PRE"){s=t.parentNode;var p=document.createElement("div");p.innerHTML="<pre><code>"+y.value+"</code></pre>";t=p.firstChild.firstChild;p.firstChild.cN=s.cN;s.parentNode.replaceChild(p.firstChild,s)}else{t.innerHTML=y.value}t.className=u;t.result={language:v,kw:y.keyword_count,re:y.r};if(y.second_best){t.second_best={language:y.second_best.language,kw:y.second_best.keyword_count,re:y.second_best.r}}}function o(){if(o.called){return}o.called=true;var r=document.getElementsByTagName("pre");for(var p=0;p<r.length;p++){var q=b(r[p]);if(q){n(q,hljs.tabReplace)}}}function l(){if(window.addEventListener){window.addEventListener("DOMContentLoaded",o,false);window.addEventListener("load",o,false)}else{if(window.attachEvent){window.attachEvent("onload",o)}else{window.onload=o}}}var e={};this.LANGUAGES=e;this.highlight=d;this.highlightAuto=g;this.fixMarkup=i;this.highlightBlock=n;this.initHighlighting=o;this.initHighlightingOnLoad=l;this.IR="[a-zA-Z][a-zA-Z0-9_]*";this.UIR="[a-zA-Z_][a-zA-Z0-9_]*";this.NR="\\b\\d+(\\.\\d+)?";this.CNR="\\b(0[xX][a-fA-F0-9]+|(\\d+(\\.\\d*)?|\\.\\d+)([eE][-+]?\\d+)?)";this.BNR="\\b(0b[01]+)";this.RSR="!|!=|!==|%|%=|&|&&|&=|\\*|\\*=|\\+|\\+=|,|\\.|-|-=|/|/=|:|;|<|<<|<<=|<=|=|==|===|>|>=|>>|>>=|>>>|>>>=|\\?|\\[|\\{|\\(|\\^|\\^=|\\||\\|=|\\|\\||~";this.ER="(?![\\s\\S])";this.BE={b:"\\\\.",r:0};this.ASM={cN:"string",b:"'",e:"'",i:"\\n",c:[this.BE],r:0};this.QSM={cN:"string",b:'"',e:'"',i:"\\n",c:[this.BE],r:0};this.CLCM={cN:"comment",b:"//",e:"$"};this.CBLCLM={cN:"comment",b:"/\\*",e:"\\*/"};this.HCM={cN:"comment",b:"#",e:"$"};this.NM={cN:"number",b:this.NR,r:0};this.CNM={cN:"number",b:this.CNR,r:0};this.BNM={cN:"number",b:this.BNR,r:0};this.inherit=function(r,s){var p={};for(var q in r){p[q]=r[q]}if(s){for(var q in s){p[q]=s[q]}}return p}}();hljs.LANGUAGES.cpp=function(){var a={keyword:{"false":1,"int":1,"float":1,"while":1,"private":1,"char":1,"catch":1,"export":1,virtual:1,operator:2,sizeof:2,dynamic_cast:2,typedef:2,const_cast:2,"const":1,struct:1,"for":1,static_cast:2,union:1,namespace:1,unsigned:1,"long":1,"throw":1,"volatile":2,"static":1,"protected":1,bool:1,template:1,mutable:1,"if":1,"public":1,friend:2,"do":1,"return":1,"goto":1,auto:1,"void":2,"enum":1,"else":1,"break":1,"new":1,extern:1,using:1,"true":1,"class":1,asm:1,"case":1,typeid:1,"short":1,reinterpret_cast:2,"default":1,"double":1,register:1,explicit:1,signed:1,typename:1,"try":1,"this":1,"switch":1,"continue":1,wchar_t:1,inline:1,"delete":1,alignof:1,char16_t:1,char32_t:1,constexpr:1,decltype:1,noexcept:1,nullptr:1,static_assert:1,thread_local:1,restrict:1,_Bool:1,complex:1},built_in:{std:1,string:1,cin:1,cout:1,cerr:1,clog:1,stringstream:1,istringstream:1,ostringstream:1,auto_ptr:1,deque:1,list:1,queue:1,stack:1,vector:1,map:1,set:1,bitset:1,multiset:1,multimap:1,unordered_set:1,unordered_map:1,unordered_multiset:1,unordered_multimap:1,array:1,shared_ptr:1}};return{dM:{k:a,i:"</",c:[hljs.CLCM,hljs.CBLCLM,hljs.QSM,{cN:"string",b:"'\\\\?.",e:"'",i:"."},{cN:"number",b:"\\b(\\d+(\\.\\d*)?|\\.\\d+)(u|U|l|L|ul|UL|f|F)"},hljs.CNM,{cN:"preprocessor",b:"#",e:"$"},{cN:"stl_container",b:"\\b(deque|list|queue|stack|vector|map|set|bitset|multiset|multimap|unordered_map|unordered_set|unordered_multiset|unordered_multimap|array)\\s*<",e:">",k:a,r:10,c:["self"]}]}}}();hljs.LANGUAGES.r={dM:{c:[hljs.HCM,{cN:"number",b:"\\b0[xX][0-9a-fA-F]+[Li]?\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\b\\d+(?:[eE][+\\-]?\\d*)?L\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\b\\d+\\.(?!\\d)(?:i\\b)?",e:hljs.IMMEDIATE_RE,r:1},{cN:"number",b:"\\b\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d*)?i?\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\.\\d+(?:[eE][+\\-]?\\d*)?i?\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"keyword",b:"(?:tryCatch|library|setGeneric|setGroupGeneric)\\b",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\.\\.\\.",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\.\\.\\d+(?![\\w.])",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\b(?:function)",e:hljs.IMMEDIATE_RE,r:2},{cN:"keyword",b:"(?:if|in|break|next|repeat|else|for|return|switch|while|try|stop|warning|require|attach|detach|source|setMethod|setClass)\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"literal",b:"(?:NA|NA_integer_|NA_real_|NA_character_|NA_complex_)\\b",e:hljs.IMMEDIATE_RE,r:10},{cN:"literal",b:"(?:NULL|TRUE|FALSE|T|F|Inf|NaN)\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"identifier",b:"[a-zA-Z.][a-zA-Z0-9._]*\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"operator",b:"<\\-(?!\\s*\\d)",e:hljs.IMMEDIATE_RE,r:2},{cN:"operator",b:"\\->|<\\-",e:hljs.IMMEDIATE_RE,r:1},{cN:"operator",b:"%%|~",e:hljs.IMMEDIATE_RE},{cN:"operator",b:">=|<=|==|!=|\\|\\||&&|=|\\+|\\-|\\*|/|\\^|>|<|!|&|\\||\\$|:",e:hljs.IMMEDIATE_RE,r:0},{cN:"operator",b:"%",e:"%",i:"\\n",r:1},{cN:"identifier",b:"`",e:"`",r:0},{cN:"string",b:'"',e:'"',c:[hljs.BE],r:0},{cN:"string",b:"'",e:"'",c:[hljs.BE],r:0},{cN:"paren",b:"[[({\\])}]",e:hljs.IMMEDIATE_RE,r:0}]}};
hljs.initHighlightingOnLoad();
</script>

<!-- MathJax scripts -->
<script type="text/javascript" src="https://cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML">
</script>


<style type="text/css">
body, td {
   font-family: sans-serif;
   background-color: white;
   font-size: 13px;
}

body {
  max-width: 800px;
  margin: auto;
  padding: 1em;
  line-height: 20px;
}

tt, code, pre {
   font-family: 'DejaVu Sans Mono', 'Droid Sans Mono', 'Lucida Console', Consolas, Monaco, monospace;
}

h1 {
   font-size:2.2em;
}

h2 {
   font-size:1.8em;
}

h3 {
   font-size:1.4em;
}

h4 {
   font-size:1.0em;
}

h5 {
   font-size:0.9em;
}

h6 {
   font-size:0.8em;
}

a:visited {
   color: rgb(50%, 0%, 50%);
}

pre, img {
  max-width: 100%;
}
pre {
  overflow-x: auto;
}
pre code {
   display: block; padding: 0.5em;
}

code {
  font-size: 92%;
  border: 1px solid #ccc;
}

code[class] {
  background-color: #F8F8F8;
}

table, td, th {
  border: none;
}

blockquote {
   color:#666666;
   margin:0;
   padding-left: 1em;
   border-left: 0.5em #EEE solid;
}

hr {
   height: 0px;
   border-bottom: none;
   border-top-width: thin;
   border-top-style: dotted;
   border-top-color: #999999;
}

@media print {
   * {
      background: transparent !important;
      color: black !important;
      filter:none !important;
      -ms-filter: none !important;
   }

   body {
      font-size:12pt;
      max-width:100%;
   }

   a, a:visited {
      text-decoration: underline;
   }

   hr {
      visibility: hidden;
      page-break-before: always;
   }

   pre, blockquote {
      padding-right: 1em;
      page-break-inside: avoid;
   }

   tr, img {
      page-break-inside: avoid;
   }

   img {
      max-width: 100% !important;
   }

   @page :left {
      margin: 15mm 20mm 15mm 10mm;
   }

   @page :right {
      margin: 15mm 10mm 15mm 20mm;
   }

   p, h2, h3 {
      orphans: 3; widows: 3;
   }

   h2, h3 {
      page-break-after: avoid;
   }
}
</style>



</head>

<body>
<h2>Standardized mean difference</h2>

<p>The standardized (mean) difference is a measure of distance between two group means in terms of one or more variables. In practice it is often used as a balance measure of individual covariates before and after propensity score matching. As it is standardized, comparison across variables on different scales is possible. For definitions see <a href="http://www.ncbi.nlm.nih.gov/pmc/articles/PMC3144483/#s11title">http://www.ncbi.nlm.nih.gov/pmc/articles/PMC3144483/#s11title</a> .</p>

<p>Standardized mean differences can be easily calculated with tableone. All standardized mean differences in this package are absolute values, thus, there is no directionality.</p>

<h2>Load packages</h2>

<pre><code class="r">## tableone package itself
library(tableone)
## PS matching
library(Matching)
## Weighted analysis
library(survey)
## Reorganizing data
library(reshape2)
## plotting
library(ggplot2)
</code></pre>

<h2>Load data</h2>

<p>The right heart catheterization dataset is available at <a href="http://biostat.mc.vanderbilt.edu/wiki/Main/DataSets">http://biostat.mc.vanderbilt.edu/wiki/Main/DataSets</a> . This dataset was originally used in Connors <em>et al</em>. JAMA 1996;276:889-897, and has been made publicly available.</p>

<pre><code class="r">## Right heart cath dataset
rhc &lt;- read.csv(&quot;http://biostat.mc.vanderbilt.edu/wiki/pub/Main/DataSets/rhc.csv&quot;)
</code></pre>

<h2>Unmatched table</h2>

<p>Out of the 50 covariates, 32 have standardized mean differences of greater than 0.1, which is often considered the sign of important covariate imbalance (<a href="http://www.ncbi.nlm.nih.gov/pmc/articles/PMC3144483/#s11title">http://www.ncbi.nlm.nih.gov/pmc/articles/PMC3144483/#s11title</a> ).</p>

<pre><code class="r">## Covariates
vars &lt;- c(&quot;age&quot;,&quot;sex&quot;,&quot;race&quot;,&quot;edu&quot;,&quot;income&quot;,&quot;ninsclas&quot;,&quot;cat1&quot;,&quot;das2d3pc&quot;,&quot;dnr1&quot;,
          &quot;ca&quot;,&quot;surv2md1&quot;,&quot;aps1&quot;,&quot;scoma1&quot;,&quot;wtkilo1&quot;,&quot;temp1&quot;,&quot;meanbp1&quot;,&quot;resp1&quot;,
          &quot;hrt1&quot;,&quot;pafi1&quot;,&quot;paco21&quot;,&quot;ph1&quot;,&quot;wblc1&quot;,&quot;hema1&quot;,&quot;sod1&quot;,&quot;pot1&quot;,&quot;crea1&quot;,
          &quot;bili1&quot;,&quot;alb1&quot;,&quot;resp&quot;,&quot;card&quot;,&quot;neuro&quot;,&quot;gastr&quot;,&quot;renal&quot;,&quot;meta&quot;,&quot;hema&quot;,
          &quot;seps&quot;,&quot;trauma&quot;,&quot;ortho&quot;,&quot;cardiohx&quot;,&quot;chfhx&quot;,&quot;dementhx&quot;,&quot;psychhx&quot;,
          &quot;chrpulhx&quot;,&quot;renalhx&quot;,&quot;liverhx&quot;,&quot;gibledhx&quot;,&quot;malighx&quot;,&quot;immunhx&quot;,
          &quot;transhx&quot;,&quot;amihx&quot;)

## Construct a table
tabUnmatched &lt;- CreateTableOne(vars = vars, strata = &quot;swang1&quot;, data = rhc, test = FALSE)
## Show table with SMD
print(tabUnmatched, smd = TRUE)
</code></pre>

<pre><code>                        Stratified by swang1
                         No RHC          RHC             SMD   
  n                        3551            2184                
  age (mean (SD))         61.76 (17.29)   60.75 (15.63)   0.061
  sex = Male (%)           1914 (53.9)     1278 (58.5)    0.093
  race (%)                                                0.036
     black                  585 (16.5)      335 (15.3)         
     other                  213 ( 6.0)      142 ( 6.5)         
     white                 2753 (77.5)     1707 (78.2)         
  edu (mean (SD))         11.57 (3.13)    11.86 (3.16)    0.091
  income (%)                                              0.142
     $11-$25k               713 (20.1)      452 (20.7)         
     $25-$50k               500 (14.1)      393 (18.0)         
     &gt; $50k                 257 ( 7.2)      194 ( 8.9)         
     Under $11k            2081 (58.6)     1145 (52.4)         
  ninsclas (%)                                            0.194
     Medicaid               454 (12.8)      193 ( 8.8)         
     Medicare               947 (26.7)      511 (23.4)         
     Medicare &amp; Medicaid    251 ( 7.1)      123 ( 5.6)         
     No insurance           186 ( 5.2)      136 ( 6.2)         
     Private                967 (27.2)      731 (33.5)         
     Private &amp; Medicare     746 (21.0)      490 (22.4)         
  cat1 (%)                                                0.583
     ARF                   1581 (44.5)      909 (41.6)         
     CHF                    247 ( 7.0)      209 ( 9.6)         
     COPD                   399 (11.2)       58 ( 2.7)         
     Cirrhosis              175 ( 4.9)       49 ( 2.2)         
     Colon Cancer             6 ( 0.2)        1 ( 0.0)         
     Coma                   341 ( 9.6)       95 ( 4.3)         
     Lung Cancer             34 ( 1.0)        5 ( 0.2)         
     MOSF w/Malignancy      241 ( 6.8)      158 ( 7.2)         
     MOSF w/Sepsis          527 (14.8)      700 (32.1)         
  das2d3pc (mean (SD))    20.37 (5.48)    20.70 (5.03)    0.063
  dnr1 = Yes (%)            499 (14.1)      155 ( 7.1)    0.228
  ca (%)                                                  0.107
     Metastatic             261 ( 7.4)      123 ( 5.6)         
     No                    2652 (74.7)     1727 (79.1)         
     Yes                    638 (18.0)      334 (15.3)         
  surv2md1 (mean (SD))     0.61 (0.19)     0.57 (0.20)    0.198
  aps1 (mean (SD))        50.93 (18.81)   60.74 (20.27)   0.501
  scoma1 (mean (SD))      22.25 (31.37)   18.97 (28.26)   0.110
  wtkilo1 (mean (SD))     65.04 (29.50)   72.36 (27.73)   0.256
  temp1 (mean (SD))       37.63 (1.74)    37.59 (1.83)    0.021
  meanbp1 (mean (SD))     84.87 (38.87)   68.20 (34.24)   0.455
  resp1 (mean (SD))       28.98 (13.95)   26.65 (14.17)   0.165
  hrt1 (mean (SD))       112.87 (40.94)  118.93 (41.47)   0.147
  pafi1 (mean (SD))      240.63 (116.66) 192.43 (105.54)  0.433
  paco21 (mean (SD))      39.95 (14.24)   36.79 (10.97)   0.249
  ph1 (mean (SD))          7.39 (0.11)     7.38 (0.11)    0.120
  wblc1 (mean (SD))       15.26 (11.41)   16.27 (12.55)   0.084
  hema1 (mean (SD))       32.70 (8.79)    30.51 (7.42)    0.269
  sod1 (mean (SD))       137.04 (7.68)   136.33 (7.60)    0.092
  pot1 (mean (SD))         4.08 (1.04)     4.05 (1.01)    0.027
  crea1 (mean (SD))        1.92 (2.03)     2.47 (2.05)    0.270
  bili1 (mean (SD))        2.00 (4.43)     2.71 (5.33)    0.145
  alb1 (mean (SD))         3.16 (0.67)     2.98 (0.93)    0.230
  resp = Yes (%)           1481 (41.7)      632 (28.9)    0.270
  card = Yes (%)           1007 (28.4)      924 (42.3)    0.295
  neuro = Yes (%)           575 (16.2)      118 ( 5.4)    0.353
  gastr = Yes (%)           522 (14.7)      420 (19.2)    0.121
  renal = Yes (%)           147 ( 4.1)      148 ( 6.8)    0.116
  meta = Yes (%)            172 ( 4.8)       93 ( 4.3)    0.028
  hema = Yes (%)            239 ( 6.7)      115 ( 5.3)    0.062
  seps = Yes (%)            515 (14.5)      516 (23.6)    0.234
  trauma = Yes (%)           18 ( 0.5)       34 ( 1.6)    0.104
  ortho = Yes (%)             3 ( 0.1)        4 ( 0.2)    0.027
  cardiohx (mean (SD))     0.16 (0.37)     0.20 (0.40)    0.116
  chfhx (mean (SD))        0.17 (0.37)     0.19 (0.40)    0.069
  dementhx (mean (SD))     0.12 (0.32)     0.07 (0.25)    0.163
  psychhx (mean (SD))      0.08 (0.27)     0.05 (0.21)    0.143
  chrpulhx (mean (SD))     0.22 (0.41)     0.14 (0.35)    0.192
  renalhx (mean (SD))      0.04 (0.20)     0.05 (0.21)    0.032
  liverhx (mean (SD))      0.07 (0.26)     0.06 (0.24)    0.049
  gibledhx (mean (SD))     0.04 (0.19)     0.02 (0.16)    0.070
  malighx (mean (SD))      0.25 (0.43)     0.20 (0.40)    0.101
  immunhx (mean (SD))      0.26 (0.44)     0.29 (0.45)    0.080
  transhx (mean (SD))      0.09 (0.29)     0.15 (0.36)    0.170
  amihx (mean (SD))        0.03 (0.17)     0.04 (0.20)    0.074
</code></pre>

<pre><code class="r">## Count covariates with important imbalance
addmargins(table(ExtractSmd(tabUnmatched) &gt; 0.1))
</code></pre>

<pre><code>
FALSE  TRUE   Sum 
   18    32    50 
</code></pre>

<h2>Propensity score estimation</h2>

<p>Usually a logistic regression model is used to estimate individual propensity scores. The model here is taken from &ldquo;How To Use Propensity Score Analysis&rdquo; (<a href="http://www.mc.vanderbilt.edu/crc/workshop_files/2008-04-11.pdf">http://www.mc.vanderbilt.edu/crc/workshop_files/2008-04-11.pdf</a> ). Predicted probabilities of being assigned to right heart catherterization, being assigned no right heart catherterization, being assigned to the true assignment, as well as the smaller of the probabilities of being assigned to right heart catherterization or no right heart catherterization are calculated for later use in propensity score matching and weighting.</p>

<pre><code class="r">## Fit model
psModel &lt;- glm(formula = swang1 ~ age + sex + race + edu + income + ninsclas +
                         cat1 + das2d3pc + dnr1 + ca + surv2md1 + aps1 + scoma1 +
                         wtkilo1 + temp1 + meanbp1 + resp1 + hrt1 + pafi1 +
                         paco21 + ph1 + wblc1 + hema1 + sod1 + pot1 + crea1 +
                         bili1 + alb1 + resp + card + neuro + gastr + renal +
                         meta + hema + seps + trauma + ortho + cardiohx + chfhx +
                         dementhx + psychhx + chrpulhx + renalhx + liverhx + gibledhx +
                         malighx + immunhx + transhx + amihx,
               family  = binomial(link = &quot;logit&quot;),
               data    = rhc)

## Predicted probability of being assigned to RHC
rhc$pRhc &lt;- predict(psModel, type = &quot;response&quot;)
## Predicted probability of being assigned to no RHC
rhc$pNoRhc &lt;- 1 - rhc$pRhc

## Predicted probability of being assigned to the
## treatment actually assigned (either RHC or no RHC)
rhc$pAssign &lt;- NA
rhc$pAssign[rhc$swang1 == &quot;RHC&quot;]    &lt;- rhc$pRhc[rhc$swang1   == &quot;RHC&quot;]
rhc$pAssign[rhc$swang1 == &quot;No RHC&quot;] &lt;- rhc$pNoRhc[rhc$swang1 == &quot;No RHC&quot;]
## Smaller of pRhc vs pNoRhc for matching weight
rhc$pMin &lt;- pmin(rhc$pRhc, rhc$pNoRhc)
</code></pre>

<h2>Propensity score matching</h2>

<p>The Matching package can be used for propensity score matching. The logit of propensity score is often used as the matching scale, and the matchign caliper is often 0.2 \(\times\) SD(logit(PS)). See <a href="http://www.ncbi.nlm.nih.gov/pmc/articles/PMC3144483/#s5title">http://www.ncbi.nlm.nih.gov/pmc/articles/PMC3144483/#s5title</a> for suggestions. After matching, all the standardized mean differences are below 0.1.</p>

<pre><code class="r">listMatch &lt;- Match(Tr       = (rhc$swang1 == &quot;RHC&quot;),      # Need to be in 0,1
                   ## logit of PS,i.e., log(PS/(1-PS)) as matching scale
                   X        = log(rhc$pRhc / rhc$pNoRhc),
                   ## 1:1 matching
                   M        = 1,
                   ## caliper = 0.2 * SD(logit(PS))
                   caliper  = 0.2,
                   replace  = FALSE,
                   ties     = TRUE,
                   version  = &quot;fast&quot;)
## Extract matched data
rhcMatched &lt;- rhc[unlist(listMatch[c(&quot;index.treated&quot;,&quot;index.control&quot;)]), ]

## Construct a table
tabMatched &lt;- CreateTableOne(vars = vars, strata = &quot;swang1&quot;, data = rhcMatched, test = FALSE)
## Show table with SMD
print(tabMatched, smd = TRUE)
</code></pre>

<pre><code>                        Stratified by swang1
                         No RHC          RHC             SMD   
  n                        1563            1563                
  age (mean (SD))         60.59 (17.19)   60.55 (15.71)   0.003
  sex = Male (%)            887 (56.7)      891 (57.0)    0.005
  race (%)                                                0.016
     black                  240 (15.4)      248 (15.9)         
     other                   97 ( 6.2)       99 ( 6.3)         
     white                 1226 (78.4)     1216 (77.8)         
  edu (mean (SD))         11.77 (3.15)    11.78 (3.16)    0.004
  income (%)                                              0.049
     $11-$25k               307 (19.6)      336 (21.5)         
     $25-$50k               263 (16.8)      262 (16.8)         
     &gt; $50k                 134 ( 8.6)      124 ( 7.9)         
     Under $11k             859 (55.0)      841 (53.8)         
  ninsclas (%)                                            0.042
     Medicaid               165 (10.6)      152 ( 9.7)         
     Medicare               351 (22.5)      370 (23.7)         
     Medicare &amp; Medicaid     92 ( 5.9)       94 ( 6.0)         
     No insurance            92 ( 5.9)       90 ( 5.8)         
     Private                512 (32.8)      498 (31.9)         
     Private &amp; Medicare     351 (22.5)      359 (23.0)         
  cat1 (%)                                                0.070
     ARF                    705 (45.1)      680 (43.5)         
     CHF                    168 (10.7)      175 (11.2)         
     COPD                    52 ( 3.3)       57 ( 3.6)         
     Cirrhosis               49 ( 3.1)       47 ( 3.0)         
     Colon Cancer             1 ( 0.1)        1 ( 0.1)         
     Coma                    77 ( 4.9)       76 ( 4.9)         
     Lung Cancer              1 ( 0.1)        5 ( 0.3)         
     MOSF w/Malignancy      131 ( 8.4)      128 ( 8.2)         
     MOSF w/Sepsis          379 (24.2)      394 (25.2)         
  das2d3pc (mean (SD))    20.64 (5.55)    20.58 (5.08)    0.010
  dnr1 = Yes (%)            138 ( 8.8)      130 ( 8.3)    0.018
  ca (%)                                                  0.011
     Metastatic             102 ( 6.5)       98 ( 6.3)         
     No                    1193 (76.3)     1194 (76.4)         
     Yes                    268 (17.1)      271 (17.3)         
  surv2md1 (mean (SD))     0.58 (0.20)     0.59 (0.20)    0.007
  aps1 (mean (SD))        57.41 (19.53)   57.26 (19.65)   0.008
  scoma1 (mean (SD))      18.75 (28.97)   18.87 (28.25)   0.004
  wtkilo1 (mean (SD))     70.83 (26.32)   70.73 (27.19)   0.004
  temp1 (mean (SD))       37.62 (1.90)    37.62 (1.74)    0.003
  meanbp1 (mean (SD))     73.52 (35.35)   73.09 (35.73)   0.012
  resp1 (mean (SD))       28.13 (13.99)   28.07 (14.17)   0.004
  hrt1 (mean (SD))       117.35 (42.66)  117.77 (40.24)   0.010
  pafi1 (mean (SD))      209.57 (107.95) 211.26 (107.98)  0.016
  paco21 (mean (SD))      37.66 (11.18)   37.46 (11.56)   0.017
  ph1 (mean (SD))          7.39 (0.11)     7.39 (0.11)    0.004
  wblc1 (mean (SD))       15.78 (12.25)   15.93 (13.00)   0.012
  hema1 (mean (SD))       30.90 (8.01)    30.89 (7.53)    0.001
  sod1 (mean (SD))       136.59 (7.79)   136.64 (7.42)    0.006
  pot1 (mean (SD))         4.02 (1.04)     4.04 (0.99)    0.021
  crea1 (mean (SD))        2.27 (2.29)     2.28 (1.97)    0.006
  bili1 (mean (SD))        2.50 (5.29)     2.55 (5.09)    0.010
  alb1 (mean (SD))         3.03 (0.70)     3.04 (0.96)    0.013
  resp = Yes (%)            532 (34.0)      519 (33.2)    0.018
  card = Yes (%)            597 (38.2)      598 (38.3)    0.001
  neuro = Yes (%)           116 ( 7.4)      109 ( 7.0)    0.017
  gastr = Yes (%)           275 (17.6)      291 (18.6)    0.027
  renal = Yes (%)            91 ( 5.8)       94 ( 6.0)    0.008
  meta = Yes (%)             75 ( 4.8)       74 ( 4.7)    0.003
  hema = Yes (%)            100 ( 6.4)       97 ( 6.2)    0.008
  seps = Yes (%)            331 (21.2)      332 (21.2)    0.002
  trauma = Yes (%)           15 ( 1.0)       13 ( 0.8)    0.014
  ortho = Yes (%)             2 ( 0.1)        1 ( 0.1)    0.021
  cardiohx (mean (SD))     0.20 (0.40)     0.20 (0.40)    0.003
  chfhx (mean (SD))        0.20 (0.40)     0.20 (0.40)   &lt;0.001
  dementhx (mean (SD))     0.07 (0.26)     0.07 (0.26)   &lt;0.001
  psychhx (mean (SD))      0.05 (0.22)     0.05 (0.23)    0.011
  chrpulhx (mean (SD))     0.15 (0.36)     0.15 (0.36)   &lt;0.001
  renalhx (mean (SD))      0.05 (0.22)     0.05 (0.22)    0.003
  liverhx (mean (SD))      0.07 (0.25)     0.07 (0.26)    0.008
  gibledhx (mean (SD))     0.03 (0.17)     0.03 (0.17)   &lt;0.001
  malighx (mean (SD))      0.23 (0.42)     0.23 (0.42)    0.002
  immunhx (mean (SD))      0.29 (0.45)     0.28 (0.45)    0.014
  transhx (mean (SD))      0.12 (0.33)     0.12 (0.33)    0.002
  amihx (mean (SD))        0.03 (0.18)     0.03 (0.17)    0.007
</code></pre>

<pre><code class="r">## Count covariates with important imbalance
addmargins(table(ExtractSmd(tabMatched) &gt; 0.1))
</code></pre>

<pre><code>
FALSE   Sum 
   50    50 
</code></pre>

<h2>Propensity score matching weight</h2>

<p>The matching weight method is a weighting analogue to the 1:1 pairwise algorithmic matching (<a href="http://www.ncbi.nlm.nih.gov/pubmed/23902694">http://www.ncbi.nlm.nih.gov/pubmed/23902694</a> ). The matching weight is defined as the smaller of the predicted probabilities of receiving or not receiving the treatment over the predicted probability of being assigned to the arm the patient is actually in. After weighting, all the standardized mean differences are below 0.1. The standardized mean differences in weighted data are explained in <a href="http://onlinelibrary.wiley.com/doi/10.1002/sim.6607/full">http://onlinelibrary.wiley.com/doi/10.1002/sim.6607/full</a> .</p>

<pre><code class="r">## Matching weight
rhc$mw &lt;- rhc$pMin / rhc$pAssign
## Weighted data
rhcSvy &lt;- svydesign(ids = ~ 1, data = rhc, weights = ~ mw)

## Construct a table (This is a bit slow.)
tabWeighted &lt;- svyCreateTableOne(vars = vars, strata = &quot;swang1&quot;, data = rhcSvy, test = FALSE)
## Show table with SMD
print(tabWeighted, smd = TRUE)
</code></pre>

<pre><code>                        Stratified by swang1
                         No RHC           RHC              SMD   
  n                      1522.89          1520.27                
  age (mean (SD))          60.82 (17.16)    60.77 (15.79)   0.003
  sex = Male (%)           875.8 (57.5)     872.3 (57.4)    0.003
  race (%)                                                  0.009
     black                 238.1 (15.6)     235.8 (15.5)         
     other                  94.9 ( 6.2)      97.8 ( 6.4)         
     white                1189.9 (78.1)    1186.6 (78.1)         
  edu (mean (SD))          11.80 (3.17)     11.80 (3.09)    0.002
  income (%)                                                0.004
     $11-$25k              316.5 (20.8)     317.0 (20.9)         
     $25-$50k              251.7 (16.5)     250.8 (16.5)         
     &gt; $50k                127.1 ( 8.3)     128.4 ( 8.4)         
     Under $11k            827.6 (54.3)     824.1 (54.2)         
  ninsclas (%)                                              0.014
     Medicaid              153.7 (10.1)     151.9 (10.0)         
     Medicare              361.1 (23.7)     369.0 (24.3)         
     Medicare &amp; Medicaid    91.5 ( 6.0)      91.2 ( 6.0)         
     No insurance           85.8 ( 5.6)      86.6 ( 5.7)         
     Private               487.0 (32.0)     482.2 (31.7)         
     Private &amp; Medicare    343.7 (22.6)     339.3 (22.3)         
  cat1 (%)                                                  0.017
     ARF                   685.8 (45.0)     679.9 (44.7)         
     CHF                   160.1 (10.5)     163.2 (10.7)         
     COPD                   56.2 ( 3.7)      57.2 ( 3.8)         
     Cirrhosis              45.0 ( 3.0)      47.0 ( 3.1)         
     Colon Cancer            0.9 ( 0.1)       1.0 ( 0.1)         
     Coma                   79.4 ( 5.2)      77.4 ( 5.1)         
     Lung Cancer             4.2 ( 0.3)       5.0 ( 0.3)         
     MOSF w/Malignancy     122.4 ( 8.0)     121.5 ( 8.0)         
     MOSF w/Sepsis         368.9 (24.2)     368.1 (24.2)         
  das2d3pc (mean (SD))     20.58 (5.45)     20.56 (5.05)    0.005
  dnr1 = Yes (%)           131.5 ( 8.6)     129.2 ( 8.5)    0.005
  ca (%)                                                    0.006
     Metastatic             98.6 ( 6.5)      98.0 ( 6.4)         
     No                   1160.5 (76.2)    1162.3 (76.5)         
     Yes                   263.7 (17.3)     259.9 (17.1)         
  surv2md1 (mean (SD))      0.58 (0.20)      0.58 (0.20)    0.010
  aps1 (mean (SD))         57.30 (19.53)    57.13 (19.73)   0.008
  scoma1 (mean (SD))       19.12 (29.10)    19.10 (28.51)   0.001
  wtkilo1 (mean (SD))      70.19 (26.54)    70.19 (27.30)  &lt;0.001
  temp1 (mean (SD))        37.63 (1.88)     37.64 (1.74)   &lt;0.001
  meanbp1 (mean (SD))      73.18 (35.48)    73.22 (35.50)   0.001
  resp1 (mean (SD))        28.16 (13.84)    28.10 (14.09)   0.004
  hrt1 (mean (SD))        116.96 (42.74)   116.71 (40.28)   0.006
  pafi1 (mean (SD))       209.93 (107.48)  210.31 (108.23)  0.004
  paco21 (mean (SD))       37.56 (10.80)    37.51 (11.59)   0.004
  ph1 (mean (SD))           7.39 (0.11)      7.39 (0.11)    0.003
  wblc1 (mean (SD))        15.82 (12.03)    15.69 (12.69)   0.010
  hema1 (mean (SD))        30.90 (8.10)     30.95 (7.57)    0.007
  sod1 (mean (SD))        136.54 (7.86)    136.58 (7.38)    0.005
  pot1 (mean (SD))          4.04 (1.04)      4.05 (0.99)    0.004
  crea1 (mean (SD))         2.27 (2.31)      2.27 (1.95)   &lt;0.001
  bili1 (mean (SD))         2.50 (5.37)      2.54 (5.15)    0.008
  alb1 (mean (SD))          3.04 (0.70)      3.04 (0.97)   &lt;0.001
  resp = Yes (%)           516.6 (33.9)     512.6 (33.7)    0.004
  card = Yes (%)           582.2 (38.2)     585.6 (38.5)    0.006
  neuro = Yes (%)          109.6 ( 7.2)     109.0 ( 7.2)    0.001
  gastr = Yes (%)          270.3 (17.8)     272.7 (17.9)    0.005
  renal = Yes (%)           89.5 ( 5.9)      90.7 ( 6.0)    0.004
  meta = Yes (%)            70.0 ( 4.6)      70.2 ( 4.6)    0.001
  hema = Yes (%)            93.5 ( 6.1)      95.0 ( 6.2)    0.004
  seps = Yes (%)           325.5 (21.4)     322.0 (21.2)    0.005
  trauma = Yes (%)          14.8 ( 1.0)      14.3 ( 0.9)    0.003
  ortho = Yes (%)            1.0 ( 0.1)       0.9 ( 0.1)    0.003
  cardiohx (mean (SD))      0.20 (0.40)      0.20 (0.40)   &lt;0.001
  chfhx (mean (SD))         0.20 (0.40)      0.20 (0.40)    0.004
  dementhx (mean (SD))      0.08 (0.26)      0.08 (0.26)    0.003
  psychhx (mean (SD))       0.05 (0.23)      0.05 (0.22)    0.004
  chrpulhx (mean (SD))      0.16 (0.36)      0.16 (0.36)    0.001
  renalhx (mean (SD))       0.05 (0.22)      0.05 (0.22)    0.001
  liverhx (mean (SD))       0.07 (0.25)      0.07 (0.25)    0.003
  gibledhx (mean (SD))      0.03 (0.17)      0.03 (0.17)    0.007
  malighx (mean (SD))       0.23 (0.42)      0.23 (0.42)    0.007
  immunhx (mean (SD))       0.28 (0.45)      0.28 (0.45)   &lt;0.001
  transhx (mean (SD))       0.12 (0.33)      0.12 (0.33)    0.004
  amihx (mean (SD))         0.03 (0.18)      0.03 (0.18)    0.006
</code></pre>

<pre><code class="r">## Count covariates with important imbalance
addmargins(table(ExtractSmd(tabWeighted) &gt; 0.1))
</code></pre>

<pre><code>
FALSE   Sum 
   50    50 
</code></pre>

<h2>Assessing balance before and after matching/weighting</h2>

<p>A plot showing covariate balance is often constructed to demonstrate the balancing effect of matching and/or weighting. Given the same propensity score model, the matching weight method often achieves better covariate balance than matching.</p>

<pre><code class="r">## Construct a data frame containing variable name and SMD from all methods
dataPlot &lt;- data.frame(variable  = names(ExtractSmd(tabUnmatched)),
                       Unmatched = ExtractSmd(tabUnmatched),
                       Matched   = ExtractSmd(tabMatched),
                       Weighted  = ExtractSmd(tabWeighted))
</code></pre>

<pre><code>Error in data.frame(variable = names(ExtractSmd(tabUnmatched)), Unmatched = ExtractSmd(tabUnmatched), : arguments imply differing number of rows: 0, 50
</code></pre>

<pre><code class="r">## Create long-format data for ggplot2
dataPlotMelt &lt;- melt(data          = dataPlot,
                     id.vars       = c(&quot;variable&quot;),
                     variable.name = &quot;Method&quot;,
                     value.name    = &quot;SMD&quot;)
</code></pre>

<pre><code>Error in melt(data = dataPlot, id.vars = c(&quot;variable&quot;), variable.name = &quot;Method&quot;, : object &#39;dataPlot&#39; not found
</code></pre>

<pre><code class="r">## Order variable names by magnitude of SMD
varNames &lt;- as.character(dataPlot$variable)[order(dataPlot$Unmatched)]
</code></pre>

<pre><code>Error in eval(expr, envir, enclos): object &#39;dataPlot&#39; not found
</code></pre>

<pre><code class="r">## Order factor levels in the same order
dataPlotMelt$variable &lt;- factor(dataPlotMelt$variable,
                                levels = varNames)
</code></pre>

<pre><code>Error in factor(dataPlotMelt$variable, levels = varNames): object &#39;dataPlotMelt&#39; not found
</code></pre>

<pre><code class="r">## Plot using ggplot2
ggplot(data = dataPlotMelt, mapping = aes(x = variable, y = SMD,
                                          group = Method, color = Method)) +
geom_line() +
geom_point() +
geom_hline(yintercept = 0.1, color = &quot;black&quot;, size = 0.1) +
coord_flip() +
theme_bw() + theme(legend.key = element_blank())
</code></pre>

<pre><code>Error in ggplot(data = dataPlotMelt, mapping = aes(x = variable, y = SMD, : object &#39;dataPlotMelt&#39; not found
</code></pre>

<p>To construct a side-by-side table, data can be extracted as a matrix and combined using the print() method, which actually invisibly returns a matrix.</p>

<pre><code class="r">## Column bind tables
resCombo &lt;- cbind(print(tabUnmatched, printToggle = FALSE),
                  print(tabMatched,   printToggle = FALSE),
                  print(tabWeighted,  printToggle = FALSE))

## Add group name row, and rewrite column names
resCombo &lt;- rbind(Group = rep(c(&quot;No RHC&quot;,&quot;RHC&quot;), 3), resCombo)
colnames(resCombo) &lt;- c(&quot;Unmatched&quot;,&quot;&quot;,&quot;Matched&quot;,&quot;&quot;,&quot;Weighted&quot;,&quot;&quot;)
print(resCombo, quote = FALSE)
</code></pre>

<pre><code>                       Unmatched                       Matched                         Weighted                         
Group                  No RHC          RHC             No RHC          RHC             No RHC           RHC             
n                        3551            2184            1563            1563          1522.89          1520.27         
age (mean (SD))         61.76 (17.29)   60.75 (15.63)   60.59 (17.19)   60.55 (15.71)    60.82 (17.16)    60.77 (15.79) 
sex = Male (%)           1914 (53.9)     1278 (58.5)      887 (56.7)      891 (57.0)     875.8 (57.5)     872.3 (57.4)  
race (%)                                                                                                                
   black                  585 (16.5)      335 (15.3)      240 (15.4)      248 (15.9)     238.1 (15.6)     235.8 (15.5)  
   other                  213 ( 6.0)      142 ( 6.5)       97 ( 6.2)       99 ( 6.3)      94.9 ( 6.2)      97.8 ( 6.4)  
   white                 2753 (77.5)     1707 (78.2)     1226 (78.4)     1216 (77.8)    1189.9 (78.1)    1186.6 (78.1)  
edu (mean (SD))         11.57 (3.13)    11.86 (3.16)    11.77 (3.15)    11.78 (3.16)     11.80 (3.17)     11.80 (3.09)  
income (%)                                                                                                              
   $11-$25k               713 (20.1)      452 (20.7)      307 (19.6)      336 (21.5)     316.5 (20.8)     317.0 (20.9)  
   $25-$50k               500 (14.1)      393 (18.0)      263 (16.8)      262 (16.8)     251.7 (16.5)     250.8 (16.5)  
   &gt; $50k                 257 ( 7.2)      194 ( 8.9)      134 ( 8.6)      124 ( 7.9)     127.1 ( 8.3)     128.4 ( 8.4)  
   Under $11k            2081 (58.6)     1145 (52.4)      859 (55.0)      841 (53.8)     827.6 (54.3)     824.1 (54.2)  
ninsclas (%)                                                                                                            
   Medicaid               454 (12.8)      193 ( 8.8)      165 (10.6)      152 ( 9.7)     153.7 (10.1)     151.9 (10.0)  
   Medicare               947 (26.7)      511 (23.4)      351 (22.5)      370 (23.7)     361.1 (23.7)     369.0 (24.3)  
   Medicare &amp; Medicaid    251 ( 7.1)      123 ( 5.6)       92 ( 5.9)       94 ( 6.0)      91.5 ( 6.0)      91.2 ( 6.0)  
   No insurance           186 ( 5.2)      136 ( 6.2)       92 ( 5.9)       90 ( 5.8)      85.8 ( 5.6)      86.6 ( 5.7)  
   Private                967 (27.2)      731 (33.5)      512 (32.8)      498 (31.9)     487.0 (32.0)     482.2 (31.7)  
   Private &amp; Medicare     746 (21.0)      490 (22.4)      351 (22.5)      359 (23.0)     343.7 (22.6)     339.3 (22.3)  
cat1 (%)                                                                                                                
   ARF                   1581 (44.5)      909 (41.6)      705 (45.1)      680 (43.5)     685.8 (45.0)     679.9 (44.7)  
   CHF                    247 ( 7.0)      209 ( 9.6)      168 (10.7)      175 (11.2)     160.1 (10.5)     163.2 (10.7)  
   COPD                   399 (11.2)       58 ( 2.7)       52 ( 3.3)       57 ( 3.6)      56.2 ( 3.7)      57.2 ( 3.8)  
   Cirrhosis              175 ( 4.9)       49 ( 2.2)       49 ( 3.1)       47 ( 3.0)      45.0 ( 3.0)      47.0 ( 3.1)  
   Colon Cancer             6 ( 0.2)        1 ( 0.0)        1 ( 0.1)        1 ( 0.1)       0.9 ( 0.1)       1.0 ( 0.1)  
   Coma                   341 ( 9.6)       95 ( 4.3)       77 ( 4.9)       76 ( 4.9)      79.4 ( 5.2)      77.4 ( 5.1)  
   Lung Cancer             34 ( 1.0)        5 ( 0.2)        1 ( 0.1)        5 ( 0.3)       4.2 ( 0.3)       5.0 ( 0.3)  
   MOSF w/Malignancy      241 ( 6.8)      158 ( 7.2)      131 ( 8.4)      128 ( 8.2)     122.4 ( 8.0)     121.5 ( 8.0)  
   MOSF w/Sepsis          527 (14.8)      700 (32.1)      379 (24.2)      394 (25.2)     368.9 (24.2)     368.1 (24.2)  
das2d3pc (mean (SD))    20.37 (5.48)    20.70 (5.03)    20.64 (5.55)    20.58 (5.08)     20.58 (5.45)     20.56 (5.05)  
dnr1 = Yes (%)            499 (14.1)      155 ( 7.1)      138 ( 8.8)      130 ( 8.3)     131.5 ( 8.6)     129.2 ( 8.5)  
ca (%)                                                                                                                  
   Metastatic             261 ( 7.4)      123 ( 5.6)      102 ( 6.5)       98 ( 6.3)      98.6 ( 6.5)      98.0 ( 6.4)  
   No                    2652 (74.7)     1727 (79.1)     1193 (76.3)     1194 (76.4)    1160.5 (76.2)    1162.3 (76.5)  
   Yes                    638 (18.0)      334 (15.3)      268 (17.1)      271 (17.3)     263.7 (17.3)     259.9 (17.1)  
surv2md1 (mean (SD))     0.61 (0.19)     0.57 (0.20)     0.58 (0.20)     0.59 (0.20)      0.58 (0.20)      0.58 (0.20)  
aps1 (mean (SD))        50.93 (18.81)   60.74 (20.27)   57.41 (19.53)   57.26 (19.65)    57.30 (19.53)    57.13 (19.73) 
scoma1 (mean (SD))      22.25 (31.37)   18.97 (28.26)   18.75 (28.97)   18.87 (28.25)    19.12 (29.10)    19.10 (28.51) 
wtkilo1 (mean (SD))     65.04 (29.50)   72.36 (27.73)   70.83 (26.32)   70.73 (27.19)    70.19 (26.54)    70.19 (27.30) 
temp1 (mean (SD))       37.63 (1.74)    37.59 (1.83)    37.62 (1.90)    37.62 (1.74)     37.63 (1.88)     37.64 (1.74)  
meanbp1 (mean (SD))     84.87 (38.87)   68.20 (34.24)   73.52 (35.35)   73.09 (35.73)    73.18 (35.48)    73.22 (35.50) 
resp1 (mean (SD))       28.98 (13.95)   26.65 (14.17)   28.13 (13.99)   28.07 (14.17)    28.16 (13.84)    28.10 (14.09) 
hrt1 (mean (SD))       112.87 (40.94)  118.93 (41.47)  117.35 (42.66)  117.77 (40.24)   116.96 (42.74)   116.71 (40.28) 
pafi1 (mean (SD))      240.63 (116.66) 192.43 (105.54) 209.57 (107.95) 211.26 (107.98)  209.93 (107.48)  210.31 (108.23)
paco21 (mean (SD))      39.95 (14.24)   36.79 (10.97)   37.66 (11.18)   37.46 (11.56)    37.56 (10.80)    37.51 (11.59) 
ph1 (mean (SD))          7.39 (0.11)     7.38 (0.11)     7.39 (0.11)     7.39 (0.11)      7.39 (0.11)      7.39 (0.11)  
wblc1 (mean (SD))       15.26 (11.41)   16.27 (12.55)   15.78 (12.25)   15.93 (13.00)    15.82 (12.03)    15.69 (12.69) 
hema1 (mean (SD))       32.70 (8.79)    30.51 (7.42)    30.90 (8.01)    30.89 (7.53)     30.90 (8.10)     30.95 (7.57)  
sod1 (mean (SD))       137.04 (7.68)   136.33 (7.60)   136.59 (7.79)   136.64 (7.42)    136.54 (7.86)    136.58 (7.38)  
pot1 (mean (SD))         4.08 (1.04)     4.05 (1.01)     4.02 (1.04)     4.04 (0.99)      4.04 (1.04)      4.05 (0.99)  
crea1 (mean (SD))        1.92 (2.03)     2.47 (2.05)     2.27 (2.29)     2.28 (1.97)      2.27 (2.31)      2.27 (1.95)  
bili1 (mean (SD))        2.00 (4.43)     2.71 (5.33)     2.50 (5.29)     2.55 (5.09)      2.50 (5.37)      2.54 (5.15)  
alb1 (mean (SD))         3.16 (0.67)     2.98 (0.93)     3.03 (0.70)     3.04 (0.96)      3.04 (0.70)      3.04 (0.97)  
resp = Yes (%)           1481 (41.7)      632 (28.9)      532 (34.0)      519 (33.2)     516.6 (33.9)     512.6 (33.7)  
card = Yes (%)           1007 (28.4)      924 (42.3)      597 (38.2)      598 (38.3)     582.2 (38.2)     585.6 (38.5)  
neuro = Yes (%)           575 (16.2)      118 ( 5.4)      116 ( 7.4)      109 ( 7.0)     109.6 ( 7.2)     109.0 ( 7.2)  
gastr = Yes (%)           522 (14.7)      420 (19.2)      275 (17.6)      291 (18.6)     270.3 (17.8)     272.7 (17.9)  
renal = Yes (%)           147 ( 4.1)      148 ( 6.8)       91 ( 5.8)       94 ( 6.0)      89.5 ( 5.9)      90.7 ( 6.0)  
meta = Yes (%)            172 ( 4.8)       93 ( 4.3)       75 ( 4.8)       74 ( 4.7)      70.0 ( 4.6)      70.2 ( 4.6)  
hema = Yes (%)            239 ( 6.7)      115 ( 5.3)      100 ( 6.4)       97 ( 6.2)      93.5 ( 6.1)      95.0 ( 6.2)  
seps = Yes (%)            515 (14.5)      516 (23.6)      331 (21.2)      332 (21.2)     325.5 (21.4)     322.0 (21.2)  
trauma = Yes (%)           18 ( 0.5)       34 ( 1.6)       15 ( 1.0)       13 ( 0.8)      14.8 ( 1.0)      14.3 ( 0.9)  
ortho = Yes (%)             3 ( 0.1)        4 ( 0.2)        2 ( 0.1)        1 ( 0.1)       1.0 ( 0.1)       0.9 ( 0.1)  
cardiohx (mean (SD))     0.16 (0.37)     0.20 (0.40)     0.20 (0.40)     0.20 (0.40)      0.20 (0.40)      0.20 (0.40)  
chfhx (mean (SD))        0.17 (0.37)     0.19 (0.40)     0.20 (0.40)     0.20 (0.40)      0.20 (0.40)      0.20 (0.40)  
dementhx (mean (SD))     0.12 (0.32)     0.07 (0.25)     0.07 (0.26)     0.07 (0.26)      0.08 (0.26)      0.08 (0.26)  
psychhx (mean (SD))      0.08 (0.27)     0.05 (0.21)     0.05 (0.22)     0.05 (0.23)      0.05 (0.23)      0.05 (0.22)  
chrpulhx (mean (SD))     0.22 (0.41)     0.14 (0.35)     0.15 (0.36)     0.15 (0.36)      0.16 (0.36)      0.16 (0.36)  
renalhx (mean (SD))      0.04 (0.20)     0.05 (0.21)     0.05 (0.22)     0.05 (0.22)      0.05 (0.22)      0.05 (0.22)  
liverhx (mean (SD))      0.07 (0.26)     0.06 (0.24)     0.07 (0.25)     0.07 (0.26)      0.07 (0.25)      0.07 (0.25)  
gibledhx (mean (SD))     0.04 (0.19)     0.02 (0.16)     0.03 (0.17)     0.03 (0.17)      0.03 (0.17)      0.03 (0.17)  
malighx (mean (SD))      0.25 (0.43)     0.20 (0.40)     0.23 (0.42)     0.23 (0.42)      0.23 (0.42)      0.23 (0.42)  
immunhx (mean (SD))      0.26 (0.44)     0.29 (0.45)     0.29 (0.45)     0.28 (0.45)      0.28 (0.45)      0.28 (0.45)  
transhx (mean (SD))      0.09 (0.29)     0.15 (0.36)     0.12 (0.33)     0.12 (0.33)      0.12 (0.33)      0.12 (0.33)  
amihx (mean (SD))        0.03 (0.17)     0.04 (0.20)     0.03 (0.18)     0.03 (0.17)      0.03 (0.18)      0.03 (0.18)  
</code></pre>

<h2>Outcome analysis</h2>

<p>The final analysis can be conducted using matched and weighted data. The results from the matching and matching weight are similar. ShowRegTable() function may come in handly.</p>

<pre><code class="r">## Unmatched model (unadjsuted)
glmUnmatched &lt;- glm(formula = (death == &quot;Yes&quot;) ~ swang1,
                    family  = binomial(link = &quot;logit&quot;),
                    data    = rhc)
## Matched model
glmMatched &lt;- glm(formula = (death == &quot;Yes&quot;) ~ swang1,
                  family  = binomial(link = &quot;logit&quot;),
                  data    = rhcMatched)
## Weighted model
glmWeighted &lt;- svyglm(formula = (death == &quot;Yes&quot;) ~ swang1,
                      family  = binomial(link = &quot;logit&quot;),
                      design    = rhcSvy)

## Show results together
resTogether &lt;- list(Unmatched = ShowRegTable(glmUnmatched, printToggle = FALSE),
                    Matched   = ShowRegTable(glmMatched, printToggle = FALSE),
                    Weighted  = ShowRegTable(glmWeighted, printToggle = FALSE))
print(resTogether, quote = FALSE)
</code></pre>

<pre><code>$Unmatched
            exp(coef) [confint] p     
(Intercept) 1.70 [1.59, 1.82]   &lt;0.001
swang1RHC   1.25 [1.12, 1.40]   &lt;0.001

$Matched
            exp(coef) [confint] p     
(Intercept) 1.72 [1.55, 1.91]   &lt;0.001
swang1RHC   1.31 [1.13, 1.51]   &lt;0.001

$Weighted
            exp(coef) [confint] p     
(Intercept) 1.70 [1.56, 1.85]   &lt;0.001
swang1RHC   1.31 [1.14, 1.49]   &lt;0.001
</code></pre>

<hr/>

<ul>
<li>Authored by Kazuki Yoshida</li>
<li>CRAN page: <a href="https://cran.r-project.org/package=tableone">https://cran.r-project.org/package=tableone</a></li>
<li>github page: <a href="https://github.com/kaz-yos/tableone">https://github.com/kaz-yos/tableone</a></li>
</ul>

</body>

</html>
